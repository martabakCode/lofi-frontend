<div class="relative">
    <!-- Trigger -->
    <button (click)="toggle()"
        class="flex items-center gap-3 group cursor-pointer p-1.5 rounded-xl transition-all focus:outline-none focus:ring-2 focus:ring-brand-main/20"
        [class.bg-bg-muted]="isOpen()">
        <div class="text-right hidden sm:block">
            <p class="text-sm font-bold text-text-primary leading-tight group-hover:text-brand-main transition-colors">
                {{ user()?.fullName || user()?.username || 'Guest' }}
            </p>
            <p class="text-[10px] text-brand-main font-semibold uppercase tracking-widest">
                {{ getRoleName() || 'Access' }}
            </p>
        </div>
        <div class="w-10 h-10 rounded-xl bg-brand-soft text-brand-main flex items-center justify-center font-bold shadow-sm transition-all border border-brand-main/10"
            [class.shadow-brand-main-20]="isOpen()" [class.scale-105]="isOpen()">
            {{ getInitials() }}
        </div>
    </button>

    <!-- Menu -->
    @if (isOpen()) {
    <div
        class="absolute right-0 top-full mt-2 w-56 bg-bg-surface border border-border-default rounded-xl shadow-xl overflow-hidden z-50 animate-in fade-in slide-in-from-top-2 duration-200">

        <!-- Mobile Info (visible only on small screens) -->
        <div class="sm:hidden p-4 border-b border-border-default bg-bg-muted/30">
            <p class="text-sm font-bold text-text-primary">{{ user()?.fullName || 'Guest' }}</p>
            <p class="text-xs text-text-muted">{{ user()?.email }}</p>
        </div>

        <div class="p-1.5">
            <button (click)="navigateTo('/dashboard/profile')"
                class="flex w-full items-center gap-3 px-3 py-2.5 text-sm font-medium text-text-secondary rounded-lg hover:bg-bg-muted hover:text-brand-main transition-colors">
                <i class="pi pi-user text-base"></i>
                Profile
            </button>
            <button (click)="navigateTo('/dashboard/settings/password')"
                class="flex w-full items-center gap-3 px-3 py-2.5 text-sm font-medium text-text-secondary rounded-lg hover:bg-bg-muted hover:text-brand-main transition-colors">
                <i class="pi pi-lock text-base"></i>
                Change Password
            </button>
        </div>

        <div class="h-px bg-border-default mx-2"></div>

        <div class="p-1.5">
            <button (click)="logout()"
                class="flex w-full items-center gap-3 px-3 py-2.5 text-sm font-semibold text-error-text rounded-lg hover:bg-error-bg/10 transition-colors">
                <i class="pi pi-sign-out text-base"></i>
                Logout
            </button>
        </div>
    </div>
    }
</div>
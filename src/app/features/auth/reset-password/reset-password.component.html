<div class="text-center mb-6">
    <h2 class="text-2xl font-bold text-text-primary">Reset Password</h2>
    <p class="text-text-secondary mt-2">Enter your new password below</p>
</div>

<div *ngIf="message" class="bg-green-500/10 text-green-600 p-3 rounded-lg mb-4 text-sm font-medium">
    {{ message }}
</div>
<div *ngIf="error" class="bg-red-500/10 text-red-600 p-3 rounded-lg mb-4 text-sm font-medium">
    {{ error }}
    <div *ngIf="!token" class="mt-2">
        <a (click)="requestNewLink()" class="text-brand-main hover:text-brand-hover cursor-pointer font-semibold">
            Request a new reset link
        </a>
    </div>
</div>

<form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-5">
    <div class="space-y-2">
        <label for="newPassword" class="form-label">New Password</label>
        <div class="relative">
            <i class="pi pi-lock absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"></i>
            <input id="newPassword" [type]="showNewPassword() ? 'text' : 'password'" formControlName="newPassword"
                placeholder="Enter new password" class="form-input pl-10 pr-10"
                [class.border-red-500]="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched" />
            <button type="button" (click)="toggleNewPasswordVisibility()"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition-colors">
                <i [class]="showNewPassword() ? 'pi pi-eye-slash' : 'pi pi-eye'"></i>
            </button>
        </div>

        <!-- Password Strength Indicator -->
        <div *ngIf="resetForm.get('newPassword')?.value" class="mt-2">
            <div class="flex items-center gap-2 mb-1">
                <div class="flex-1 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                    <div class="h-full transition-all duration-300" [class]="passwordStrengthColor()"
                        [style.width.%]="(passwordStrength().score / 5) * 100">
                    </div>
                </div>
                <span class="text-xs font-medium" [class.text-red-500]="passwordStrength().score <= 1"
                    [class.text-yellow-500]="passwordStrength().score > 1 && passwordStrength().score <= 2"
                    [class.text-blue-500]="passwordStrength().score > 2 && passwordStrength().score <= 3"
                    [class.text-green-500]="passwordStrength().score > 3">
                    {{ passwordStrengthLabel() }}
                </span>
            </div>
            <ul class="space-y-1">
                <li *ngFor="let req of passwordStrength().requirements" class="text-xs flex items-center gap-1"
                    [class.text-green-600]="req.met" [class.text-text-muted]="!req.met">
                    <i [class]="req.met ? 'pi pi-check-circle' : 'pi pi-circle'" class="text-xs"></i>
                    {{ req.label }}
                </li>
            </ul>
        </div>

        <small class="form-error"
            *ngIf="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched">
            <span *ngIf="resetForm.get('newPassword')?.errors?.['required']">
                Password is required
            </span>
            <span *ngIf="resetForm.get('newPassword')?.errors?.['minlength']">
                Password must be at least 8 characters
            </span>
        </small>
    </div>

    <div class="space-y-2">
        <label for="confirmPassword" class="form-label">Confirm Password</label>
        <div class="relative">
            <i class="pi pi-lock absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"></i>
            <input id="confirmPassword" [type]="showConfirmPassword() ? 'text' : 'password'"
                formControlName="confirmPassword" placeholder="Confirm new password" class="form-input pl-10 pr-10"
                [class.border-red-500]="resetForm.get('confirmPassword')?.invalid && resetForm.get('confirmPassword')?.touched || resetForm.errors?.['passwordMismatch']" />
            <button type="button" (click)="toggleConfirmPasswordVisibility()"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition-colors">
                <i [class]="showConfirmPassword() ? 'pi pi-eye-slash' : 'pi pi-eye'"></i>
            </button>
        </div>
        <small class="form-error"
            *ngIf="resetForm.get('confirmPassword')?.invalid && resetForm.get('confirmPassword')?.touched">
            Please confirm your password
        </small>
        <small class="form-error"
            *ngIf="resetForm.errors?.['passwordMismatch'] && resetForm.get('confirmPassword')?.touched">
            Passwords do not match
        </small>
    </div>

    <button type="submit" class="w-full mt-2 btn-primary py-2.5" [disabled]="resetForm.invalid || loading() || !token">
        <i *ngIf="loading()" class="pi pi-spin pi-spinner mr-2"></i>
        {{ loading() ? 'Resetting...' : 'Reset Password' }}
    </button>

    <div class="text-center mt-4">
        <a (click)="cancel()" class="text-sm font-semibold text-brand-main hover:text-brand-hover cursor-pointer">
            <i class="pi pi-arrow-left mr-1"></i> Back to Login
        </a>
    </div>
</form>
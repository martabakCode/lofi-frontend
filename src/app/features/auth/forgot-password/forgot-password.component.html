<div class="text-center mb-6">
    <h2 class="text-2xl font-bold text-text-primary">Forgot Password</h2>
    <p class="text-text-secondary mt-2" *ngIf="!emailSent()">Enter your email to receive a reset link</p>
    <p class="text-text-secondary mt-2" *ngIf="emailSent()">Check your email for the reset link</p>
</div>

<!-- Success Message with Resend Option -->
<div *ngIf="message()" class="bg-green-500/10 text-green-600 p-4 rounded-lg mb-4">
    <div class="flex items-start justify-between">
        <div>
            <p class="font-medium">{{ message() }}</p>
            <p class="text-sm mt-1 text-green-600/80">The reset link will expire in 15 minutes.</p>
        </div>
        <button *ngIf="canResend()" (click)="resendEmail()" [disabled]="loading()"
            class="text-sm font-semibold text-green-600 hover:text-green-700 transition-colors disabled:opacity-50">
            Resend
        </button>
        <span *ngIf="!canResend()" class="text-sm text-green-600/80">
            Resend in {{ resendCooldown() }}s
        </span>
    </div>
</div>

<!-- Error Message -->
<div *ngIf="error()" class="bg-red-500/10 text-red-600 p-3 rounded-lg mb-4 text-sm font-medium">
    {{ error() }}
</div>

<!-- Email Form -->
<form *ngIf="!emailSent()" [formGroup]="forgotForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-5">
    <div class="space-y-2">
        <label for="email" class="form-label">Email Address</label>
        <div class="relative">
            <i class="pi pi-envelope absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"></i>
            <input id="email" type="email" formControlName="email" placeholder="Enter your email"
                class="form-input pl-10"
                [class.border-red-500]="forgotForm.get('email')?.invalid && forgotForm.get('email')?.touched"
                (input)="error.set('')" />
        </div>
        <small class="form-error" *ngIf="forgotForm.get('email')?.invalid && forgotForm.get('email')?.touched">
            <span *ngIf="forgotForm.get('email')?.errors?.['required']">Email is required</span>
            <span *ngIf="forgotForm.get('email')?.errors?.['email']">Please enter a valid email address</span>
        </small>
    </div>

    <button type="submit" class="w-full mt-2 btn-primary py-2.5" [disabled]="forgotForm.invalid || loading()">
        <i *ngIf="loading()" class="pi pi-spin pi-spinner mr-2"></i>
        {{ loading() ? 'Sending...' : 'Send Reset Link' }}
    </button>

    <div class="text-center mt-4">
        <a routerLink="/auth/login"
            class="text-sm font-semibold text-brand-main hover:text-brand-hover transition-colors">
            <i class="pi pi-arrow-left mr-1"></i> Back to Login
        </a>
    </div>
</form>

<!-- Email Sent State -->
<div *ngIf="emailSent()" class="flex flex-col items-center gap-4">
    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center">
        <i class="pi pi-envelope text-3xl text-green-600"></i>
    </div>

    <div class="text-center">
        <p class="text-text-secondary">Didn't receive the email?</p>
        <ul class="text-sm text-text-muted mt-2 space-y-1 text-left">
            <li class="flex items-center gap-2">
                <i class="pi pi-check text-green-500 text-xs"></i>
                Check your spam or junk folder
            </li>
            <li class="flex items-center gap-2">
                <i class="pi pi-check text-green-500 text-xs"></i>
                Make sure you entered the correct email
            </li>
            <li class="flex items-center gap-2">
                <i class="pi pi-check text-green-500 text-xs"></i>
                Wait a few minutes and try again
            </li>
        </ul>
    </div>

    <button (click)="resetForm()" class="w-full mt-4 btn-secondary py-2.5">
        <i class="pi pi-arrow-left mr-2"></i>
        Back to Forgot Password
    </button>
</div>